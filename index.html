<!DOCTYPE html>
<html>
<head>
  <title>MT5 Live Ticker Data</title>
  <style>
    body { background-color: #111; color: #0f0; font-family: monospace; padding: 20px; }
    h1, #status { margin-bottom: 10px; }
    table { border-collapse: collapse; width: 100%; background-color: #000; color: #0f0; font-size: 13px; }
    th, td { border: 1px solid #0f0; padding: 6px 10px; text-align: center; }
    th { background-color: #222; }
  </style>
</head>
<body>
  <h1>üì° MT5 Real-Time Ticker Viewer</h1>
  <div id="status">Connecting to WebSocket...</div>
  <table>
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Time</th>
        <th>Bid</th>
        <th>Ask</th>
        <th>High</th>
        <th>Low</th>
        <th>Close</th>
        <th>Spread</th>
        <th>Volume</th>
        <th>Change%</th>
      </tr>
    </thead>
    <tbody id="ticker-data">
      <tr><td colspan="10">Waiting for data...</td></tr>
    </tbody>
  </table>

  <script>
    const status = document.getElementById("status");
    const tableBody = document.getElementById("ticker-data");
    const ws = new WebSocket("wss://" + window.location.host);

    ws.onopen = () => {
      status.textContent = "‚úÖ Connected to WebSocket Server";
    };

    ws.onmessage = (event) => {
      try {
        const parsed = JSON.parse(event.data);
        const timestamp = parsed.timestamp || "-";
        const data = parsed.data && parsed.data.length ? parsed.data[0] : null;
        if (!data) return;

        const row = `
          <tr>
            <td>${data.symbol}</td>
            <td>${timestamp}</td>
            <td>${data.bid}</td>
            <td>${data.ask}</td>
            <td>${data.high}</td>
            <td>${data.low}</td>
            <td>${data.close}</td>
            <td>${data.spread}</td>
            <td>${data.volume}</td>
            <td>${data.change_percent || "-"}</td>
          </tr>
        `;
        tableBody.innerHTML = row;
      } catch (e) {
        console.error("‚ùå Error parsing message:", e);
      }
    };

    ws.onclose = () => {
      status.textContent = "‚ö†Ô∏è Disconnected from WebSocket Server";
    };
  </script>
</body>
</html>
